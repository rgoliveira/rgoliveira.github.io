//! annyang
//! version : 1.1.0
//! author  : Tal Ater @TalAter
//! license : MIT
//! https://www.TalAter.com/annyang/
(function(e){"use strict";var t=this;var n=t.SpeechRecognition||t.webkitSpeechRecognition||t.mozSpeechRecognition||t.msSpeechRecognition||t.oSpeechRecognition;if(!n){t.annyang=null;return e}var r=[];var i;var s={start:[],error:[],end:[],result:[],resultMatch:[],resultNoMatch:[],errorNetwork:[],errorPermissionBlocked:[],errorPermissionDenied:[]};var o;var u=0;var a=false;var f="font-weight: bold; color: #00f;";var l=/\s*\((.*?)\)\s*/g;var c=/(\(\?:[^)]+\))\?/g;var h=/(\(\?)?:\w+/g;var p=/\*\w+/g;var d=/[\-{}\[\]+?.,\\\^$|#]/g;var v=function(e){e=e.replace(d,"\\$&").replace(l,"(?:$1)?").replace(h,function(e,t){return t?e:"([^\\s]+)"}).replace(p,"(.*?)").replace(c,"\\s*$1?\\s*");return new RegExp("^"+e+"$","i")};var m=function(e){e.forEach(function(e){e.callback.apply(e.context)})};var g=function(){if(!y()){t.annyang.init({},false)}};var y=function(){return i!==e};t.annyang={init:function(l,c){if(c===e){c=true}else{c=!!c}if(i&&i.abort){i.abort()}i=new n;i.maxAlternatives=5;i.continuous=true;i.lang="en-US";i.onstart=function(){m(s.start)};i.onerror=function(e){m(s.error);switch(e.error){case"network":m(s.errorNetwork);break;case"not-allowed":case"service-not-allowed":o=false;if((new Date).getTime()-u<200){m(s.errorPermissionBlocked)}else{m(s.errorPermissionDenied)}break}};i.onend=function(){m(s.end);if(o){var e=(new Date).getTime()-u;if(e<1e3){setTimeout(t.annyang.start,1e3-e)}else{t.annyang.start()}}};i.onresult=function(e){m(s.result);var n=e.results[e.resultIndex];var i;for(var o=0;o<n.length;o++){i=n[o].transcript.trim();if(a){t.console.log("Speech recognized: %c"+i,f)}for(var u=0,l=r.length;u<l;u++){var c=r[u].command.exec(i);if(c){var h=c.slice(1);if(a){t.console.log("command matched: %c"+r[u].originalPhrase,f);if(h.length){t.console.log("with parameters",h)}}r[u].callback.apply(this,h);m(s.resultMatch);return true}}}m(s.resultNoMatch);return false};if(c){r=[]}if(l.length){this.addCommands(l)}},start:function(t){g();t=t||{};if(t.autoRestart!==e){o=!!t.autoRestart}else{o=true}u=(new Date).getTime();i.start()},abort:function(){o=false;if(y){i.abort()}},debug:function(e){if(arguments.length>0){a=!!e}else{a=true}},setLanguage:function(e){g();i.lang=e},addCommands:function(e){var n,i;g();for(var s in e){if(e.hasOwnProperty(s)){n=t[e[s]]||e[s];if(typeof n!=="function"){continue}i=v(s);r.push({command:i,callback:n,originalPhrase:s})}}if(a){t.console.log("Commands successfully loaded: %c"+r.length,f)}},removeCommands:function(e){if(!e){r=[];return true}else{e=Array.isArray(e)?e:[e];r=r.filter(function(t){for(var n=0;n<e.length;n++){if(e[n]===t.originalPhrase){return false}}return true})}},addCallback:function(n,r,i){if(s[n]===e){return}var o=t[r]||r;if(typeof o!=="function"){return}s[n].push({callback:o,context:i||this})}}}).call(this);